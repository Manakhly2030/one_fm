[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Job Applicant",
  "modified": "2020-05-04 22:07:17.206582",
  "name": "Job Applicant-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Job Applicant', {\n\trefresh(frm) {\n\t\tfrm.set_df_property('status', 'label', 'Final Status');\n\t\tset_country_field_empty_on_load(frm);\n\t\thide_job_applicant_existing_fields(frm);\n\t\tset_required_documents_field_property(frm);\n\t\tset_read_only_fields_of_job_applicant(frm);\n\t\tset_mandatory_fields_of_job_applicant(frm);\n\t},\n\tone_fm_first_name: function(frm) {\n    set_applicant_name(frm);\n  },\n\tone_fm_second_name: function(frm) {\n    set_applicant_name(frm);\n  },\n\tone_fm_third_name: function(frm) {\n    set_applicant_name(frm);\n  },\n\tone_fm_last_name: function(frm) {\n    set_applicant_name(frm);\n  },\n\tjob_title: function(frm) {\n\t\tset_job_opening_to_applicant(frm);\n\t},\n\tone_fm_erf: function(frm) {\n\t\tset_erf_to_applicant(frm);\n\t},\n\tone_fm_source_of_hire: function(frm) {\n\t\tset_have_visa_field_properties(frm);\n\t\tset_required_documents(frm);\n\t\tif(frm.doc.one_fm_source_of_hire == 'One FM'){\n\t\t\tfrm.set_value('one_fm_agency', '');\n\t\t\tfrm.set_value('one_fm_is_agency_applying', false);\n\t\t}\n\t\tset_field_properties_on_agency_applying(frm)\n\t},\n\tone_fm_visa_type: function(frm) {\n\t\tset_required_documents(frm);\n\t},\n\tone_fm_upload_document: function(frm) {\n\t\tupload_document(frm);\n\t},\n\tone_fm_country_code_country: function(frm) {\n\t\tif(frm.doc.one_fm_country_code_country){\n\t\t\tset_country_code_to_contact_number(frm, 'one_fm_country_code');\n\t\t}\n\t\telse{\n\t\t\tfrm.set_value('one_fm_country_code', '');\n\t\t}\n\t},\n\tone_fm_country_code_country_second: function(frm) {\n\t\tif(frm.doc.one_fm_country_code_country_second){\n\t\t\tset_country_code_to_contact_number(frm, 'one_fm_country_code_second');\n\t\t}\n\t\telse{\n\t\t\tfrm.set_value('one_fm_country_code_second', '');\n\t\t}\n\t},\n\tone_fm_i_am_currently_working: function(frm) {\n\t\tset_mandatory_fields_for_current_employment(frm);\n\t},\n\tone_fm_gender: function(frm) {\n\t\tset_height_field_property_from_gender(frm);\n\t},\n\tone_fm_email_id: function(frm) {\n\t\tset_job_applicant_email_id(frm);\n\t},\n\tone_fm_have_a_valid_visa_in_kuwait: function(frm) {\n\t\tset_visa_type_field_properties(frm);\n\t\tset_cid_field_properties(frm);\n\t\tif(!frm.doc.one_fm_have_a_valid_visa_in_kuwait){\n\t\t\tfrm.set_value('one_fm_in_kuwait_at_present', false);\n\t\t}\n\t},\n\tone_fm_agency: function(frm) {\n\t\tif(!frm.doc.one_fm_agency){\n\t\t\tfrm.set_value('one_fm_is_agency_applying', false);\n\t\t}\n\t},\n\tone_fm_is_agency_applying: function(frm) {\n\t\tset_field_properties_on_agency_applying(frm);\n\t}\n});\n\nvar set_field_properties_on_agency_applying = function(frm) {\n\t// On Contact Section\n\tlet fields = ['one_fm_email_id', 'one_fm_contact_number'];\n\tif(frm.doc.one_fm_agency && frm.doc.one_fm_is_agency_applying){\n\t\tset_mandatory_fields(frm, fields, false);\n\t\tfrm.set_df_property('one_fm_contact_details_section', 'hidden', true);\n\t}\n\telse{\n\t\tfrm.set_df_property('one_fm_contact_details_section', 'hidden', false);\n\t\tset_mandatory_fields(frm, fields, true);\n\t}\n\n\t// On Work Details Section\n\tif(frm.doc.one_fm_is_agency_applying){\n\t\tfrm.set_df_property('one_fm_work_details_section', 'hidden', true);\n\t\tlet fields = ['one_fm_rotation_shift', 'one_fm_night_shift', 'one_fm_type_of_travel', 'one_fm_type_of_driving_license'];\n\t\tset_mandatory_fields(frm, fields, false);\n\t}\n\telse{\n\t\tif(frm.doc.one_fm_erf){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.client.get',\n\t\t\t\targs: {doctype: 'ERF', filters:{name: frm.doc.one_fm_erf}},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message){\n\t\t\t\t\t\tvar erf = r.message;\n\t\t\t\t\t\tset_work_details_section(frm, erf);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n};\n\nvar set_cid_field_properties = function(frm) {\n\tif(frm.doc.one_fm_have_a_valid_visa_in_kuwait){\n\t\tfrm.set_df_property('one_fm_cid_number', 'reqd', true);\n\t\tfrm.set_df_property('one_fm_cid_expire', 'reqd', true);\n\t}\n\telse{\n\t\tfrm.set_df_property('one_fm_cid_number', 'reqd', false);\n\t\tfrm.set_df_property('one_fm_cid_expire', 'reqd', false);\n\t}\n};\n\nvar set_have_visa_field_properties = function(frm) {\n\tif(frm.doc.one_fm_source_of_hire == 'Local'){\n\t\tfrm.set_value('one_fm_have_a_valid_visa_in_kuwait', true);\n\t}\n};\n\nvar set_visa_type_field_properties = function(frm) {\n\tif(frm.doc.one_fm_have_a_valid_visa_in_kuwait){\n\t\tfrm.set_df_property('one_fm_visa_type', 'reqd', true);\n\t}\n\telse{\n\t\tfrm.set_df_property('one_fm_visa_type', 'reqd', false);\n\t}\n};\n\nvar set_job_applicant_email_id = function(frm) {\n\tif(frm.doc.one_fm_email_id){\n\t\tfrm.set_value('email_id', frm.doc.one_fm_email_id);\n\t}\n\telse{\n\t\tfrm.set_value('email_id', '');\n\t}\n};\n\nvar set_height_field_property_from_gender = function(frm) {\n\tif(frm.doc.one_fm_erf && frm.doc.one_fm_gender){\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.client.get',\n\t\t\targs: {\n\t\t\t\tdoctype: 'ERF',\n\t\t\t\tfilters: {name: frm.doc.one_fm_erf}\n\t\t\t},\n\t\t\tcallback: function(r){\n\t\t\t\tlet show_height_field = false;\n\t\t\t\tlet mandatory_height_field = false;\n\t\t\t\tif(r.message && r.message.gender_height_requirement){\n\t\t\t\t\tlet height_details = r.message.gender_height_requirement;\n\t\t\t\t\theight_details.forEach((item) => {\n\t\t\t\t\t\tif(item.gender == frm.doc.one_fm_gender && item.height > 0){\n\t\t\t\t\t\t\tshow_height_field = true;\n\t\t\t\t\t\t\tif(item.is_height_mandatory){\n\t\t\t\t\t\t\t\tmandatory_height_field = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tfrm.set_df_property('one_fm_height', 'hidden', show_height_field?false:true);\n\t\t\t\tfrm.set_df_property('one_fm_height', 'reqd', mandatory_height_field?true:false);\n\t\t\t}\n\t\t});\n\t}\n\telse{\n\t\tfrm.set_df_property('one_fm_height', 'hidden', true);\n\t\tfrm.set_df_property('one_fm_height', 'reqd', false);\n\t}\n};\n\nvar set_mandatory_fields_for_current_employment = function(frm) {\n\tlet fields = ['one_fm_current_employer', 'one_fm_employment_start_date', 'one_fm_employment_end_date',\n\t\t'one_fm_current_job_title', 'one_fm_country_of_employment', 'one_fm_notice_period_in_days'];\n\tif(frm.doc.one_fm_i_am_currently_working){\n\t\tset_mandatory_fields(frm, fields, true);\n\t}\n\telse{\n\t\tset_mandatory_fields(frm, fields, false);\n\t}\n};\n\nvar set_mandatory_fields = function(frm, fields, reqd) {\n\tfields.forEach((field) => {\n\t\tfrm.set_df_property(field, 'reqd', reqd);\n\t});\n};\n\nvar set_read_only_fields_of_job_applicant = function(frm) {\n\tlet fields = ['status', 'one_fm_applicant_status', 'one_fm_application_id', 'job_title'];\n\tset_read_only_fields(frm, fields, true);\n};\n\nvar set_read_only_fields = function(frm, fields, read_only) {\n\tfields.forEach((field) => {\n\t\tfrm.set_df_property(field, 'read_only', read_only);\n\t});\n};\n\nvar set_mandatory_fields_of_job_applicant = function(frm) {\n\tlet fields = ['one_fm_last_name', 'one_fm_first_name', 'one_fm_passport_number',\n\t\t'one_fm_passport_holder_of', 'one_fm_passport_issued', 'one_fm_passport_expire', 'one_fm_gender', 'one_fm_religion',\n\t\t'one_fm_date_of_birth', 'one_fm_educational_qualification', 'one_fm_university'];\n\tset_mandatory_fields(frm, fields, true);\n};\n\nvar set_country_code_to_contact_number = function(frm, field) {\n\tfrappe.db.get_value('Country', frm.doc.one_fm_country_code_country, 'one_fm_tel_code', function(r) {\n\t\tif(r && r.one_fm_tel_code){\n\t\t\tfrm.set_value(field, r.one_fm_tel_code);\n\t\t}\n\t\telse{\n\t\t\tfrm.set_value(field, '');\n\t\t}\n\t});\n};\n\nvar set_country_field_empty_on_load = function(frm) {\n\tlet fields = ['one_fm_country_code_country', 'one_fm_country_code_country_second', 'one_fm_passport_holder_of',\n\t\t'one_fm_country_of_employment']\n\tif(frm.doc.__islocal){\n\t\tfields.forEach((field) => {\n\t\t\tfrm.set_value(field, '');\n\t\t});\n\t}\n};\n\nvar hide_job_applicant_existing_fields = function(frm) {\n\tlet fields = ['applicant_name', 'email_id', 'cover_letter', 'resume_attachment', 'section_break_6', 'one_fm_height'];\n\tset_hidden_fields(frm, fields, true);\n};\n\nvar set_hidden_fields = function(frm, fields, hidden) {\n\tfields.forEach((field) => {\n\t\tfrm.set_df_property(field, 'hidden', hidden);\n\t});\n};\n\nvar upload_document = function(frm) {\n\tif(frm.doc.one_fm_documents_required){\n\t\tvar required_doc_list = [];\n\t\tfrm.doc.one_fm_documents_required.forEach((item, i) => {\n\t\t\trequired_doc_list[i] = item.document_required\n\t\t});\n\n\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Upload Document',\n\t\t\twidth: 100,\n\t\t\tfields: [\n\t\t\t\t{fieldname:'required_document', fieldtype:'Select', label:'Required Document', reqd:1, options: required_doc_list},\n\t\t\t\t{fieldname:'attach', fieldtype:'Attach', label:'Attach'}\n\t\t\t],\n\t\t\tprimary_action_label: __(\"Upload\"),\n\t\t\tprimary_action : function(){\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Upload'),\n\t\t\t\t\tmessage: __(\"Uploaded\"),\n\t\t\t\t\tindicator: 'green'\n\t\t\t\t});\n\t\t\t\t\tdialog.hide();\n\t\t\t\t}\n\t\t})\n\t\tdialog.show();\n\t}\n};\n\nvar set_required_documents_field_property = function(frm) {\n\tlet fields = ['document_required', 'required_when', 'or_required_when', 'type_of_copy', 'or_type_of_copy', 'not_mandatory']\n\tfields.forEach((field) => {\n\t\tfrappe.meta.get_docfield(\"Recruitment Document\", field, frm.doc.name).read_only = 1;\n\t});\n};\n\nvar set_required_documents = function(frm) {\n\tif(frm.doc.one_fm_source_of_hire){\n\t\tlet filters = {};\n\t\tif(frm.doc.one_fm_source_of_hire){\n\t\t\tfilters['source_of_hire'] = frm.doc.one_fm_source_of_hire;\n\t\t\tif(frm.doc.one_fm_source_of_hire == 'Local' && frm.doc.one_fm_visa_type){\n\t\t\t\tfilters['visa_type'] = frm.doc.one_fm_visa_type;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfilters['visa_type'] = '';\n\t\t\t}\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod: 'one_fm.one_fm.doctype.recruitment_document_checklist.recruitment_document_checklist.get_recruitment_document_checklist',\n\t\t\targs: {filters: filters},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message && r.message.recruitment_documents){\n\t\t\t\t\tfrm.clear_table('one_fm_documents_required');\n\t\t\t\t\tvar document_checklist = r.message.recruitment_documents;\n\t\t\t\t\tdocument_checklist.forEach((checklist) => {\n\t\t\t\t\t\tlet doc_required = frappe.model.add_child(frm.doc, 'Recruitment Document', 'one_fm_documents_required');\n\t\t\t\t\t\tlet fields = ['document_required', 'required_when', 'or_required_when', 'type_of_copy', 'or_type_of_copy',\n\t\t\t\t\t\t\t'not_mandatory']\n\t\t\t\t\t\tfields.forEach((field) => {\n\t\t\t\t\t\t\tfrappe.model.set_value(doc_required.doctype, doc_required.name, field, checklist[field]);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tfrm.refresh_field('one_fm_documents_required');\n\t\t\t}\n\t\t});\n\t}\n};\n\nvar set_erf_to_applicant = function(frm) {\n\tif(frm.doc.one_fm_erf){\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.client.get',\n\t\t\targs: {\n\t\t\t\tdoctype: 'ERF',\n\t\t\t\tfilters: {'name': frm.doc.one_fm_erf}\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message){\n\t\t\t\t\tvar erf = r.message;\n\t\t\t\t\tset_job_opening_form_erf(frm, erf);\n\t\t\t\t\tset_erf_basic_details(frm, erf);\n\t\t\t\t\tset_work_details_section(frm, erf);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\nvar set_job_opening_form_erf = function(frm, erf) {\n\tif(!frm.doc.job_title){\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.client.get_value',\n\t\t\targs: {\n\t\t\t\tdoctype: 'Job Opening',\n\t\t\t\tfieldname: 'name',\n\t\t\t\tfilters: {one_fm_erf: erf.name}\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message && r.message.name && !frm.doc.job_title){\n\t\t\t\t\tfrm.set_value('job_title', r.message.name)\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\nvar set_work_details_section = function(frm, erf) {\n\tif(!frm.doc.one_fm_is_agency_applying){\n\t\tfrm.set_df_property('one_fm_work_details_section', 'hidden', false);\n\t\tfrm.set_df_property('one_fm_rotation_shift', 'reqd', erf.shift_working);\n\t\tfrm.set_df_property('one_fm_rotation_shift', 'hidden', !erf.shift_working);\n\t\tfrm.set_df_property('one_fm_night_shift', 'reqd', erf.night_shift);\n\t\tfrm.set_df_property('one_fm_night_shift', 'hidden', !erf.night_shift);\n\t\tfrm.set_df_property('one_fm_type_of_travel', 'reqd', erf.travel_required);\n\t\tfrm.set_df_property('one_fm_type_of_travel', 'hidden', !erf.travel_required);\n\t\tif(erf.travel_required && erf.type_of_travel){\n\t\t\tlet options = ['I Will Travel '+erf.type_of_travel, 'I Cant Travel '+erf.type_of_travel];\n\t\t\tfrm.set_df_property('one_fm_type_of_travel', 'options', options)\n\t\t}\n\t\tfrm.set_df_property('one_fm_type_of_driving_license', 'reqd', erf.driving_license_required);\n\t\tfrm.set_df_property('one_fm_type_of_driving_license', 'hidden', !erf.driving_license_required);\n\t}\n};\n\nvar set_erf_basic_details = function(frm, erf) {\n\tfrm.set_value('one_fm_hiring_method', erf.hiring_method);\n};\n\nvar set_job_opening_to_applicant = function(frm) {\n\tif(frm.doc.job_title){\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.client.get',\n\t\t\targs: {\n\t\t\t\tdoctype: 'Job Opening',\n\t\t\t\tfilters: {'name': frm.doc.job_title}\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message){\n\t\t\t\t\tvar job = r.message;\n\t\t\t\t\tfrm.set_df_property('one_fm_erf', 'read_only', true);\n\t\t\t\t\tvar fields = ['one_fm_erf', 'one_fm_source_of_hire', 'one_fm_hiring_team']\n\t\t\t\t\tfields.forEach((field) => {\n\t\t\t\t\t\tfrm.set_value(field, job[field]?job[field]:'');\n\t\t\t\t\t});\n\t\t\t\t\tset_job_basic_skill(frm, job);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\nvar set_job_basic_skill = function(frm, job) {\n\tif(job.one_fm_designation_skill && job.one_fm_designation_skill.length > 0){\n\t\tset_designation_skill(frm, job.one_fm_designation_skill);\n\t}\n\telse if(frm.doc.one_fm_erf) {\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.client.get',\n\t\t\targs: {doctype: 'ERF', filters: {name:frm.doc.one_fm_erf}},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message && r.message.designation_skill){\n\t\t\t\t\tset_designation_skill(frm, r.message.designation_skill);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\nvar set_designation_skill = function(frm, skills) {\n\tfrappe.meta.get_docfield(\"Designation Skill\", 'skill', frm.doc.name).read_only = 1;\n\tskills.forEach(function(designation_skill) {\n\t\tlet skill = frappe.model.add_child(frm.doc, 'Designation Skill', 'one_fm_designation_skill');\n\t\tfrappe.model.set_value(skill.doctype, skill.name, 'skill', designation_skill.skill);\n\t});\n\tfrm.refresh_field('one_fm_designation_skill');\n};\n\nvar set_applicant_name = function(frm) {\n  let name_fields = ['one_fm_second_name', 'one_fm_third_name', 'one_fm_last_name']\n  let applicant_name = frm.doc.one_fm_first_name ?frm.doc.one_fm_first_name:'';\n  name_fields.forEach((name_field) => {\n    if(frm.doc[name_field]){\n      applicant_name += ' '+frm.doc[name_field]\n    }\n  });\n  frm.set_value('applicant_name', applicant_name);\n};\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "ERF Request",
  "modified": "2020-05-04 06:54:02.915244",
  "name": "ERF Request-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('ERF Request', {\n\trefresh(frm) {\n\t    let fields = ['reason_for_request', 'number_of_candidates_required', 'department', 'designation',\n\t        'department_manager', 'reference_type', 'reference_name'];\n    \tset_read_only_fields(frm, fields, false);\n\t}\n});\n\nvar set_read_only_fields = function(frm, fields, read_only) {\n\tfields.forEach((field) => {\n\t\tfrm.set_df_property(field, 'read_only', read_only);\n\t});\n};"
 }
]